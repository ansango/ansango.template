<script is:inline>
  const clipboard = () => {
    const svgCopy = `<svg xmlns="http://www.w3.org/2000/svg" class="size-4" width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M14 0a5 5 0 0 1 5 5v12a7 7 0 1 1-14 0V9h2v8a5 5 0 0 0 10 0V5a3 3 0 1 0-6 0v12a1 1 0 1 0 2 0V6h2v11a3 3 0 1 1-6 0V5a5 5 0 0 1 5-5"/></svg>`;
    const svgCopied = `<svg xmlns="http://www.w3.org/2000/svg" class="size-5" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="m10.586 13.414l-2.829-2.828L6.343 12l4.243 4.243l7.07-7.071l-1.413-1.415z"/></svg>`;

    const buttonClasses = [
      "absolute",
      "top-0",
      "right-0",
      "cursor-pointer",
      "p-2",
      "flex",
      "items-center",
      "text-muted",
    ];

    const copy = async (block, button) => {
      const code = block.querySelector("code");
      const text = code?.innerText;
      if (!text) return;

      try {
        await navigator.clipboard.writeText(text);
        button.innerHTML = svgCopied;
        button.setAttribute("aria-label", "Código copiado");

        setTimeout(() => {
          button.innerHTML = svgCopy;
          button.setAttribute("aria-label", "Copiar código");
        }, 2000);
      } catch (err) {
        console.error("Failed to copy!", err);
      }
    };

    const blocks = [...document.querySelectorAll("pre:not(.has-copy-button)")];

    for (let code of blocks) {
      code.classList.add("has-copy-button");

      const wrapper = document.createElement("div");
      wrapper.classList.add("relative");

      const button = document.createElement("button");
      button.type = "button";
      button.classList.add(...buttonClasses);
      button.innerHTML = svgCopy;
      button.setAttribute("aria-label", "Copiar código");

      code.setAttribute("tabindex", "0");
      code.appendChild(button);
      code.parentNode.insertBefore(wrapper, code);
      wrapper.appendChild(code);

      button.addEventListener("click", () => copy(code, button));
    }
  };

  clipboard();
  document.addEventListener("astro:page-load", clipboard);
</script>
