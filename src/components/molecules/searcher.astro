---
/**
 * üîç Searcher Component
 * 
 * @description Full-text search interface using Astro Pagefind.
 * Opens a modal dialog with search functionality triggered by button or '/' key.
 * 
 * @usage
 * ```astro
 * <Searcher />
 * ```
 * 
 * @compatible
 * - üîé Uses SearcherIcon component
 * - ‚å®Ô∏è Keyboard shortcut (/) support
 * - üé® Custom styled Pagefind integration
 * - üëÅÔ∏è Modal dialog with backdrop blur
 */
import Search from "astro-pagefind/components/Search";
import { SearcherIcon } from "@/components/icons";
import Script from "./searcher.script.astro";
---

<Script />
<button
  id="searcher-button"
  aria-label="(Press / to open search)"
  aria-describedby="searcher"
>
  <SearcherIcon />
  <kbd>
    <span> / </span>
  </kbd>
</button>

<dialog id="searcher-dialog">
  <div id="searcher-dialog-frame">
    <Search
      id="searcher"
      uiOptions={{
        showImages: false,
        showSubResults: true,
        resetStyles: true,
        translations: {
          clear_search: "",
        },
      }}
    />
  </div>
</dialog>

<style is:global>
  @reference "@/styles/global.css";

  :root {
    --pagefind-ui-scale: 0.8;
    --pagefind-ui-primary: var(--color-accent);
    --pagefind-ui-text: var(--color-content);
    --pagefind-ui-background: var(--pagefind-background);
    --pagefind-ui-border: var(--color-divider);
    --pagefind-ui-tag: var(--color-accent);
    --pagefind-ui-border-width: 2px;
    --pagefind-ui-border-radius: 28px;
    --pagefind-ui-image-border-radius: 8px;
    --pagefind-ui-image-box-ratio: 3 / 2;
    --pagefind-ui-font: var(--font-sans);
    --pagefind-ui-scale: 0.7;
  }

  :root.dark {
    #searcher-dialog-frame {
      color-scheme: dark;
    }
  }

  #searcher-shortcut {
    @apply flex items-center;
  }

  #searcher-button {
    @apply cursor-pointer px-1 py-0.5 focus:outline-none;
    @apply sm:inset-ring-muted/5 sm:hover:bg-muted/5 sm:border-divider sm:inline-flex sm:items-center sm:gap-1 sm:rounded-full sm:border;
    kbd {
      @apply text-muted hidden gap-0.5 rounded-full px-1 py-0.5 text-xs leading-none sm:inline-flex;

      span {
        @apply mt-0.5;
      }
    }
  }

  #searcher-dialog {
    @apply bg-transparent backdrop:fixed backdrop:size-full backdrop:backdrop-blur-md;
    @apply size-full max-w-[60ch] overflow-hidden;
    @apply fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 px-4;
  }

  #searcher-dialog-frame {
    @apply mx-auto h-max max-h-[calc(100vh-40px)] overflow-y-auto;
    @apply rounded-xl;
  }

  #searcher {
    .pagefind-ui {
      @apply text-base font-normal;
    }

    .pagefind-ui__form,
    .pagefind-ui__drawer {
      @apply !bg-pagefind-body;
    }

    .pagefind-ui__form,
    .pagefind-ui__search-input {
      @apply rounded-xl;
    }

    .pagefind-ui__search-input {
      @apply border-none font-normal focus:outline-none;
    }

    .pagefind-ui__drawer {
      @apply p-4;
    }

    .pagefind-ui__form::before {
      @apply top-[calc(22px*var(--pagefind-ui-scale))] size-4;
      mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 24 24'%3E%3Cpath fill='currentColor' fill-rule='evenodd' d='M18.319 14.433A8.001 8.001 0 0 0 6.343 3.868a8 8 0 0 0 10.564 11.976l.043.045l4.242 4.243a1 1 0 1 0 1.415-1.415l-4.243-4.242zm-2.076-9.15a6 6 0 1 1-8.485 8.485a6 6 0 0 1 8.485-8.485' clip-rule='evenodd'/%3E%3C/svg%3E");
    }

    .pagefind-ui__message {
      @apply text-muted pt-0 pb-2 text-sm;
    }

    .pagefind-ui__result {
      @apply border-t-[1px] py-1;
    }

    .pagefind-ui__result:last-of-type {
      @apply border-b-[1px];
    }

    .pagefind-ui__button {
      @apply hover:bg-muted/10 border-[1px] text-xs font-medium hover:border-0;
    }

    .pagefind-ui__result-link {
      @apply hover:text-link font-semibold underline underline-offset-2;
    }

    .pagefind-ui__result-excerpt {
      @apply text-muted line-clamp-1 text-xs;
    }
  }
</style>
