---
/**
 * üìù EntryDefault Template
 * 
 * @description Default template for individual entry pages.
 * Full entry view with heading, content, tags, and share options.
 * 
 * @usage
 * ```astro
 * <EntryDefault entry={blogEntry} />
 * ```
 * 
 * @compatible
 * - üìå EntryHeading for metadata display
 * - üì§ Share component for RSS/copy
 * - üß© Breadcrumbs for nested content
 * - üéØ LayoutDefault wrapper
 * - üìù Markdown content rendering
 * - ‚è±Ô∏è Reading time calculation
 */
import type { Entry } from "@/lib/collections";
import { getEntry, render } from "astro:content";

import { LayoutDefault } from "@/components/layout";
import { getReadingTime } from "@/lib/utils";
import { EntryHeading, Share } from "@/components/molecules";
import { getBreadcrumbs } from "@/lib/breadcrumbs";
import { site } from "@/constants";

const { collection, id } = Astro.props as Entry;

const entry = await getEntry(collection, id);

if (!entry) {
  throw new Error(`Entry not found: ${collection}/${id}`);
}

const { Content } = await render(entry);
const { title, date, mod, description, tags } = entry.data;
const readingTime = getReadingTime(entry.body || "");

const headingProps = {
  title,
  date,
  mod,
  description,
  tags,
  readingTime,
  collection,
};

const pathSegments = Astro.url.pathname.split("/").filter(Boolean);
const isNestedContent = pathSegments.length > 2;
const breadcrumbs = isNestedContent
  ? getBreadcrumbs(Astro.url.pathname, title)
  : undefined;

const layoutProps = {
  title,
  description,
  ogType: "article" as const,
  publishedTime: date?.toISOString(),
  modifiedTime: mod?.toISOString(),
  tags,
  breadcrumbs,
};

// Only show share buttons for blog, wiki, and projects
const showShare = ["blog", "wiki", "projects"].includes(collection);
const shareUrl = `${site.url}${Astro.url.pathname}`;
---

<LayoutDefault {...layoutProps} type="article">
  <EntryHeading {...headingProps} />
  <Content />
  {showShare && <Share url={shareUrl} />}
</LayoutDefault>
